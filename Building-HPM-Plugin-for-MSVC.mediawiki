After you've either built your own plugin or downloaded a plugin from the forums, you need to configure your build to include the plugin as a sub project.

There are 2 guides on how to prepare your Microsoft Visual Studio C++ (MSVC) environment for a new [[HPM]] plugin.

You can choose to follow either one.

= Requirements =

You need the following:

'''An IDE to build your server with'''

[https://visualstudio.microsoft.com/vs/ Microsoft Visual Studio IDE] - This [https://en.wikipedia.org/wiki/Integrated_development_environment?oldformat=true IDE] will be used to build your main build solution (your Hercules server), and to include your plugins as new sub projects.

As of December 2018, the IDE version I used for updating this guide uses <code>Microsoft Visual Studio Community 2017, Version 15.2</code>. This property can be viewed when you open the IDE and go to <code>Help > About Microsoft Visual Studio</code>.

'''A reliable text editor'''

[https://notepad-plus-plus.org/ Notepad++] - A convenient improvement to the standard notepad editor. This will be used when editing <code>.conf</code> files or <code>.c</code>. Unlike more complicated text editors ([https://www.sublimetext.com/3 Sublime Text 3], [https://code.visualstudio.com/ Visual Code]), Notepad++ is much much simpler and would be less confusing for new programmers.

'''The plugin you wish to install'''

For this tutorial on how to build your HPM plugin, we will use <code>YourProject</code> as the name of the plugin. This means that it is contained in a file called <code>YourProject.c</code>. Plugins can be downloaded from the [http://herc.ws/board/forum/142-plugin-releases/ Hercules Board, Plugin Releases].

= New Method =

This new method is recommended. There are two parts to the new method: integrating the plugin into your project's build solution and adding your plugin to the configuration files.

It uses the latest build software (Visual Studio IDE Community 2017) and would most likely be the software that you can access and download as of this date.

This method was imported from the Wiki data in 2016, and was updated as of December 2018.

== Integrating the Plugin ==

'''Step 1'''

Download the <code>YourProject.c</code> from the [http://herc.ws/board/forum/142-plugin-releases/ Hercules Board, Plugin Releases] or build it yourself.

'''Step 2'''

Copy or move the <code>YourProject.c</code> file into your <code>/src/plugins/</code> folder.
[[http://herc.ws/wiki/images/thumb/3/3a/MSVC_step0.png/750px-MSVC_step0.png]]

'''Step 3'''

Depending on which Visual Studio C project version (<code>.vcproj</code>) you are using, navigate to the appropriate folder.

For example, if you are using Microsoft Visual Studio IDE (Community 2017), navigate to the directory <code>\vcproj-14\</code>. We use 14 because that is the latest build type available (better to use 14 instead of using the older build solutions).
[[http://herc.ws/wiki/images/thumb/d/d1/MSVC_step1.png/750px-MSVC_step1.png]]

'''Step 4'''

Select <code>plugin-sample.vcxproj</code>, copy the file, and paste it on the same directory. This will produce a copy of the file with filename <code>plugin-sample - Copy.vcxproj</code>.
[[http://herc.ws/wiki/images/thumb/3/33/MSVC_step2.png/750px-MSVC_step2.png]]

'''Step 5'''

Rename <code>plugin-sample - Copy.vcxproj</code> into <code>YourProject.vcxproj</code>

While renaming, Highlight the word '''YourProject''' and Copy it by ''Ctrl+C''
[[http://herc.ws/wiki/images/thumb/7/78/MSVC_step3.png/750px-MSVC_step3.png]]

'''Step 6'''

Right click on <code>YourProject.vcxproj</code>, select <code>Edit with Notepad++</code> or Microsoft Notepad.
[[http://herc.ws/wiki/images/thumb/7/7c/MSVC_step4.png/750px-MSVC_step4.png]]

'''Step 7'''

Find the following line:
 <ProjectName>plugin-sample</ProjectName>
[[http://herc.ws/wiki/images/thumb/d/d8/MSVC_step5.png/750px-MSVC_step5.png]]
Replace <code>plugin-sample</code> with <code>YourProject</code>. Make sure that you copy this correctly and not make typos.

To avoid typos, you can use <code>CTRL+C</code> to copy the name of the plugin and <code>CTRL+V</code> to paste the name of the plugin without making mistakes.
[[http://herc.ws/wiki/images/thumb/c/c2/MSVC_step5_.png/750px-MSVC_step5_.png]]

'''Step 8'''

Find the following line:
 <TargetName Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">sample</TargetName>
[[http://herc.ws/wiki/images/thumb/5/5c/MSVC_step6.png/750px-MSVC_step6.png]]

Replace <code>sample</code> to <code>YourProject</code>.
 <TargetName Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">YourProject</TargetName>
[[http://herc.ws/wiki/images/thumb/b/b6/MSVC_step6_.png/750px-MSVC_step6_.png]]

'''Step 9'''

Find the following line:
 <ClCompile Include="..\src\plugins\sample.c" />
[[http://herc.ws/wiki/images/thumb/2/23/MSVC_step7.png/750px-MSVC_step7.png]]

Replace <code>sample</code> to <code>YourProject</code>.
[[http://herc.ws/wiki/images/thumb/7/75/MSVC_step7_.png/750px-MSVC_step7_.png]]

'''Step 10'''

Save the file by pressing <code>CTRL+S</code>.

'''Step 11'''

From your the main folder of your server, open the appropriate Visual Studio solution file <code>Hercules-N.sln</code> using your IDE. In this example, we used <code>Hercules-14.sln</code> because we are using Microsoft Visual Studio (Community 2017). 

'''Step 12'''

On the Solution Explorer tab, right click <code>Hercules-14</code>, select <code>Add > Existing Project...</code>

'''Step 13'''

Select <code>YourProject.vcxproj</code> in the <code>\vcproj-14\</code> folder.

'''Step 14'''

Right click <code>Solution 'Hercules-14'</code> and select <code>Build Solution</code>.

This will now re-build your Hercules server while also integrating your plugin. This patches up the source code as necessary and includes the code into the appropriate <code>.c</code> files without you having to go to the individual files.

== Adding your plugin to the configuration ==

Finally, we will open the file <code>/conf/plugins.conf</code> and include the name of our new plugin into the list.
  plugins_list: [
  	/* Enable HPMHooking when plugins in use rely on Hooking */
  	//"HPMHooking",
  	//"db2sql",
  	//"sample",
  	//"other",
  	"YourProject"
  ]

= Old Method =

{{Quote|text=This guide used Microsoft Visual Studio C++ (MSVC) 2008 as an IDE. This guide was tested using that IDE as well. It was also tested using Microsoft Visual Studio C++ 2010.|sign=Ind}}

== Instructions ==

'''Step 1'''

Go to '''src/plugins/''' folder, create a new '''.c''' file, e.g. '''dance.c''' (this name will be used throughout this guide)
[[File:step1.JPG|center|750px]]

'''Step 2'''
Open dance.c and paste this code
<pre>
#include "common/hercules.h" // Should always be the first Hercules file included! (if you don't make it first, you won't be able to use interfaces)
#include <stdio.h>
#include <string.h>
#include "common/HPMi.h"
#include "map/script.h"
#include "map/pc.h"
#include "common/HPMDataCheck.h" // should always be the last file included! (if you don't make it last, it'll intentionally break compile time)

HPExport struct hplugin_info pinfo = {
	"dance",		// Plugin name
	SERVER_TYPE_MAP,// Which server types this plugin works with?
	"0.2",			// Plugin version
	HPM_VERSION,	// HPM Version (don't change, macro is automatically updated)
};

ACMD(dance) {
	if (!message || !*message) {
		clif->message(fd, "usage: @dance 1-9");
		return -1;
	}
	if ( atoi(message) == 1 ) {
		clif->specialeffect(&sd->bl, 413, ALL_CLIENT);
	} else if ( atoi(message) == 2 ) {
		clif->specialeffect(&sd->bl, 414, ALL_CLIENT);
	} else if ( atoi(message) == 3 ) {
		clif->specialeffect(&sd->bl, 415, ALL_CLIENT);
	} else if ( atoi(message) == 4 ) {
		clif->specialeffect(&sd->bl, 426, ALL_CLIENT);
	} else if ( atoi(message) == 5 ) {
		clif->specialeffect(&sd->bl, 458, ALL_CLIENT);
	} else if ( atoi(message) == 6 ) {
		clif->specialeffect(&sd->bl, 466, ALL_CLIENT);
	} else if ( atoi(message) == 7 ) {
		clif->specialeffect(&sd->bl, 501, ALL_CLIENT);
	} else if ( atoi(message) == 8 ) {
		clif->specialeffect(&sd->bl, 540, ALL_CLIENT);
	} else if ( atoi(message) == 9 ) {
		clif->specialeffect(&sd->bl, 550, ALL_CLIENT);
	} else {
		clif->message(fd, "usage: @dance 1-9"); 
	}
	return true;
}

/* Server Startup */
HPExport void plugin_init (void) {
	addAtcommand("dance",dance);
}
</pre>

'''Step 3'''

Open your MSVC project (e.g. '''Hercules-10.sln'')
[[File:step2.JPG|center|750px]]

'''Step 4'''

Go to the '''Solution Explorer'''
[[File:step3.JPG|center|750px]]

'''Step 5'''

Right click the Hercules project (first item in '''Solution Explorer'''), and click '''Add->New Project'''
[[File:step4.JPG|center|750px]]

'''Step 6'''

Select '''General''', and pick '''Empty Project'''.
[[File:step5.JPG|center|750px]]

'''Step 7'''

Enter the name of your plugin in the '''Name''' field, and click OK.

'''Step 8'''

In the solution explorer it'll display the new project.
[[File:step6.JPG|center|750px]]

'''Step 9'''

Right click the new project, and open '''Add->Existing Item'''
[[File:step7.JPG|center|750px]]

'''Step 10'''

Browse to '''src/plugins/''' and select the '''dance.c''' file, and hit OK.
[[File:step8.JPG|center|750px]]

'''Step 11'''

It will place the '''dance.c''' file under the '''Source Files''' folder, drag it to the project you created and drop it (in a manner it be placed out of the source files folder.)
[[File:step9.JPG|center|750px]]
(It should look like the image below)
[[File:step10.JPG|center|750px]]

'''Step 12'''

With the '''dance.c''' out of the folders, delete the 3 of them (select the 3, hit delete, hit ok)
[[File:step11.JPG|center|750px]]
(It should look like the image below)
[[File:step12.JPG|center|750px]]

'''Step 13'''

Right click the project you created, open '''Properties'''
[[File:step13.JPG|center|750px]]

'''Step 14'''

Under '''Configuration Properties''' click '''General''', change '''Output Directory''' to '''..\plugins\''', '''Intermediate Directory''' to '''$(ProjectName)\$(ConfigurationName)\''' and  '''Configuration Type''' to '''Dynamic Library (.dll)'''
[[File:step14.JPG|center|750px]]

'''Step 15'''

Under '''Configuration Properties''' click '''C/C++''' and open '''General''', change '''Additional Include Directories''' to '''..\src;..\3rdparty;..\3rdparty\msinttypes\include;%(AdditionalIncludeDirectories)'''
[[File:step15.JPG|center|750px]]

'''Step 16'''

Under '''Configuration Properties''' click '''Linker''' and open '''General''', change '''Output File''' to '''$(OutDir)\$(ProjectName).dll'''
[[File:step16.JPG|center|750px]]

'''Step 17'''

Under '''Configuration Properties''' click '''C/C++''' and open '''Preprocessor''', change '''Preprocessor Definitions''' to '''_WINDLL;PCRE_SUPPORT;%(PreprocessorDefinitions)'''
[[File:step17.jpg|center|750px]]

'''Step 18'''

Under '''Configuration Properties''' click '''C/C++''' and open '''Advanced''', on '''Disable Specific Warnings''' add '''4996;%(DisableSpecificWarnings)'''
<br>This step can prevent errors like ''sscanf'' or ''sprintf'' that only happen with Microsoft compiler.
[[File:step18.png|center|750px]]

'''Step 19'''

Add your code to the '''dance.c''' file, and then right-click the project you created, and select '''Build'''

'''Step 20'''

Add it to ''' /conf/plugins.conf'''
<pre>
plugins_list: [
	/* Enable HPMHooking when plugins in use rely on Hooking */
	//"HPMHooking",
	//"db2sql",
	//"sample",
	//"other",
	"dance", // loads dance plugin
]
</pre>

= Notes =
* This guide is probably the worst I've ever written, if you can do better please hit the 'Edit' button, will be most welcome. - Ind
* I used MSVC 2008 when testing this guide.

= New Note =
* Sorry for editing this page, I added step by step images for other people to follow so they can easily follow one of the best feature Hercules have, the HPM. - Thanna
* The tutorial is tested on MSVC 2010.
* Another method idea by hemagx, sorry for publish it first - AnnieRuru.

[[Category:Installation]]
